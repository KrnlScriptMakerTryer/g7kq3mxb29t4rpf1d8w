<Module>
  <ModulePrefs title="Google.com" />
  <Content type="html">
    <![CDATA[
<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/karala-ar/vaydanam@main/style.css" />

  <style>
    canvas:focus {
      outline: none;
    }

    html, body {
      padding: 0;
      margin: 0;
      overflow: hidden;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      height: 100%;
    }
  </style>
</head>

<body class="dark">

  <div id="unity-container" class="unity-desktop">
    <canvas id="unity-canvas" tabindex="-1"></canvas>
  </div>

  <div id="loading-cover" style="display:none;">
    <div id="unity-loading-bar">
      <div id="unity-logo">
      </div>

      <div id="unity-progress-bar-empty" style="display: none;">
        <div id="unity-progress-bar-full"></div>
        <div id="txtloadingw">Drift Hunters - RU G+</div>
      </div>
    </div>
  </div>

  <script>
    async function mergeUnityWebFiles(baseUrl, filePrefix, totalParts, extension) {
      const partUrls = [];
      for (let i = 1; i <= totalParts; i++) {
        partUrls.push(`${baseUrl}/${filePrefix}_part${i}.${extension}`);
      }

      const buffers = [];
      for (let i = 0; i < totalParts; i++) {
        const response = await fetch(partUrls[i]);
        if (!response.ok) {
          throw new Error(`Failed to load part: ${partUrls[i]}`);
        }

        const buffer = await response.arrayBuffer();
        buffers.push(buffer);

        const progress = ((i + 1) / totalParts) * 100;
        document.querySelector("#unity-progress-bar-full").style.width = `${progress}%`;
      }

      const totalLength = buffers.reduce((acc, buffer) => acc + buffer.byteLength, 0);
      const combinedBuffer = new Uint8Array(totalLength);

      let offset = 0;
      buffers.forEach((buffer) => {
        combinedBuffer.set(new Uint8Array(buffer), offset);
        offset += buffer.byteLength;
      });

      return combinedBuffer;
    }

    const buildUrl = "https://cdn.jsdelivr.net/gh/karala-ar/vaydanam@main/build";
    const loaderUrl = buildUrl + "/RuDrift.loader.js";

    const config = {
      dataUrl: null,
      frameworkUrl: buildUrl + "/RuDrift.framework.js.unityweb",
      codeUrl: buildUrl + "/RuDrift.wasm.unityweb",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "DefaultCompany",
      productName: "Drift Tuner RU",
      productVersion: "1.0",
    };

    const container = document.querySelector("#unity-container");
    const canvas = document.querySelector("#unity-canvas");
    const loadingCover = document.querySelector("#loading-cover");
    const progressBarEmpty = document.querySelector("#unity-progress-bar-empty");
    const progressBarFull = document.querySelector("#unity-progress-bar-full");
    const spinner = document.querySelector('.spinner');

    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
      container.className = "unity-mobile";
    }

    loadingCover.style.display = "";

    async function initializeGame() {
      try {
        const dataBuffer = await mergeUnityWebFiles(buildUrl, "RuDrift", 3, "data.unityweb");
        const dataBlobUrl = URL.createObjectURL(
          new Blob([dataBuffer], { type: "application/octet-stream" })
        );

        config.dataUrl = dataBlobUrl;

        const unityLoader = document.createElement("script");
        unityLoader.src = loaderUrl;

        unityLoader.onload = () => {
          createUnityInstance(canvas, config, (progress) => {
            progressBarFull.style.width = 100 * progress + "%";
          }).then((unityInstance) => {
            myGameInstance = unityInstance;
            loadingCover.style.display = "none";
          }).catch((message) => {
            alert(message);
          });
        };

        document.body.appendChild(unityLoader);

      } catch (error) {
        console.error("Unity load error:", error);
      }
    }

    initializeGame();

    document.addEventListener('contextmenu', event => event.preventDefault());

    function FocusGame() {
      window.focus();
      canvas.focus();
    }

    window.addEventListener('pointerdown', FocusGame);
    window.addEventListener('touchstart', FocusGame);

    let StartUnityInstance;
    let myGameInstance;

    let ysdk = null;

    let environmentData = {
      language: "en",
      domain: "default_domain",
      deviceType: "desktop",
      isMobile: false,
      isDesktop: true,
      isTablet: false,
      isTV: false,
      appID: "default_app_id",
      browserLang: navigator.language || "en",
      payload: null,
      promptCanShow: false,
      reviewCanShow: false,
      platform: navigator.platform,
      browser: (function () {
        let userAgent = navigator.userAgent;
        if (userAgent.includes("YaBrowser")) return "Yandex";
        if (userAgent.includes("OPR") || userAgent.includes("Opera")) return "Opera";
        if (userAgent.includes("Firefox")) return "Firefox";
        if (userAgent.includes("MSIE") || userAgent.includes("Trident")) return "IE";
        if (userAgent.includes("Edge")) return "Edge";
        if (userAgent.includes("Chrome")) return "Chrome";
        if (userAgent.includes("Safari")) return "Safari";
        return "Other";
      })()
    };

    let cloudSaves = 'noData';
    let paymentsData = 'none';
    let playerData = 'noData';

    let player = null;
    let payments = null;
    let initGame = false;
    let nowFullAdOpen = false;

    function GetPayments() {
      console.warn("GetPayments is not implemented");
      return Promise.resolve("none");
    }

    function SaveCloud() {
      console.warn("SaveCloud is not implemented");
    }

    function LoadCloud() {
      console.warn("LoadCloud is not implemented");
      return Promise.resolve("noData");
    }

    function InitPlayer() {
      console.warn("InitPlayer is not implemented");
      return Promise.resolve("noData");
    }

    function FullAdShow() {
      console.warn("FullAdShow is not implemented");
    }

    function RewardedShow() {
      console.warn("RewardedShow is not implemented");
    }

    function StickyAdActivity() {
      console.warn("StickyAdActivity is not implemented");
    }

    function Review() {
      console.warn("Review is not implemented");
    }

    function PromptShow() {
      console.warn("PromptShow is not implemented");
    }

    function InitLeaderboards() {
      console.warn("InitLeaderboards is not implemented");
    }

    function GetLeaderboardScores() {
      console.warn("GetLeaderboardScores is not implemented");
    }

    function SetLeaderboardScores() {
      console.warn("SetLeaderboardScores is not implemented");
    }

    function ConsumePurchase() {
      console.warn("ConsumePurchase is not implemented");
    }

    function ConsumePurchases() {
      console.warn("ConsumePurchases is not implemented");
    }

    function InitGame() {
      try {
        console.log('Init Game Success');
        initGame = true;

        if (nowFullAdOpen === true && myGameInstance != null) {
          myGameInstance.SendMessage('YandexGame', 'OpenFullAd');
        }

      } catch (error) {
        console.error("Error in InitGame:", error);
      }
    }

    window.addEventListener("unhandledrejection", function (event) {
      console.warn("Error skipped:", event.reason);
      event.preventDefault();
    });
  </script>

  <!-- GOOGLE ADS -->

  <style>
    #ad-container {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: min(728px, calc(100% - 20px));
      height: 90px;
      background: rgba(0, 0, 0, 0.90);
      display: none;
      z-index: 99999;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.45);
      transition: transform 0.5s ease-in-out;
    }

    #ad-container.hidden {
      transform: translate(-50%, -100%);
    }

    #ad-iframe {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 745px;
      height: 90px;
      border: 0;
      display: block;
      overflow: hidden;
      pointer-events: auto;
    }

    #ad-iframe::-webkit-scrollbar {
      display: none;
    }

    #close-ad {
      position: absolute;
      top: 6px;
      right: 8px;
      background: #ff4d4d;
      color: #fff;
      border: none;
      padding: 5px 9px;
      font-size: 13px;
      border-radius: 4px;
      cursor: not-allowed;
      opacity: 0.72;
      z-index: 100000;
      display: flex;
      align-items: center;
    }

    #close-ad.enabled {
      cursor: pointer;
      opacity: 1;
    }

    #close-ad::before {
      content: 'â†‘';
      margin-right: 4px;
    }

    #ad-right-mask {
      position: absolute;
      top: 0;
      right: 0;
      width: 12px;
      height: 100%;
      pointer-events: none;
      background: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.9));
      z-index: 99999;
    }

    @media (max-width: 440px) {
      #ad-container {
        width: calc(100% - 12px);
        left: 50%;
        transform: translateX(-50%);
      }

      #ad-iframe {
        width: 708px;
      }
    }
  </style>

  <div id="ad-container" aria-hidden="true" role="dialog" aria-label="Advertisement">
    <iframe
      id="ad-iframe"
      src="https://script.google.com/macros/s/AKfycbzA6GNdpfUShkCh6apD0D21YAUf7A5d3Guhq2PayqLbk_5XG_wQhy0bdYzKJWLhzgMVMQ/exec"
      width="768px"
      height="95px"
      scrolling="no"
      frameborder="0"
      sandbox="allow-scripts allow-popups allow-same-origin">
    </iframe>

    <button id="close-ad" disabled>Close (12)</button>
    <div id="ad-right-mask"></div>
  </div>

  <script>
    (function () {
      const showDelay = 2000;
      const countdownStart = 12;
      const reappearDelay = 25000;

      const adContainer = document.getElementById('ad-container');
      const closeBtn = document.getElementById('close-ad');

      function showAd() {
        adContainer.style.display = 'block';
        adContainer.classList.remove('hidden');
        adContainer.setAttribute('aria-hidden', 'false');

        let timeLeft = countdownStart;
        closeBtn.textContent = `Close (${timeLeft})`;
        closeBtn.disabled = true;
        closeBtn.classList.remove('enabled');
</html>
    ]]>
  </Content>
</Module>